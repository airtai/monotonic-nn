Heart disease
================

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

Heart Disease \[1\] is a classification dataset used for predicting the
presence of heart disease with 13 features:

- age

- sex

- cp

- trestbps

- chol

- fbs

- restecg

- thalach

- exang

- oldpeak

- slope

- ca

- thal

The dependant variable is monotonically increasing with respect to
features `trestbps` and cholestrol (`chol`). The
`monotonicity_indicator` corrsponding to these features are set to 1.

References:

1.  John H. Gennari, Pat Langley, and Douglas H. Fisher. Models of
    incremental concept formation. Artif. Intell., 40(1-3):11–61, 1989.

    https://archive.ics.uci.edu/ml/datasets/heart+disease

2.  Aishwarya Sivaraman, Golnoosh Farnadi, Todd Millstein, and Guy Van
    den Broeck. Counterexample-guided learning of monotonic neural
    networks. Advances in Neural Information Processing Systems,
    33:11936–11948, 2020

``` python
monotonicity_indicator = {
    "age": 0,
    "sex": 0,
    "cp": 0,
    "trestbps": 1,
    "chol": 1,
    "fbs": 0,
    "restecg": 0,
    "thalach": 0,
    "exang": 0,
    "oldpeak": 0,
    "slope": 0,
    "ca": 0,
    "thal": 0,
}
```

## Running in Google Colab

<a href="https://colab.research.google.com/github/airtai/monotonic-nn/blob/main/nbs/experiments/Heart.ipynb" target=”_blank”>
<img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open in Colab" />
</a>

These are a few examples of the dataset:

<style type="text/css">
</style>
<table id="T_9c77c">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_9c77c_level0_col0" class="col_heading level0 col0" >0</th>
      <th id="T_9c77c_level0_col1" class="col_heading level0 col1" >1</th>
      <th id="T_9c77c_level0_col2" class="col_heading level0 col2" >2</th>
      <th id="T_9c77c_level0_col3" class="col_heading level0 col3" >3</th>
      <th id="T_9c77c_level0_col4" class="col_heading level0 col4" >4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_9c77c_level0_row0" class="row_heading level0 row0" >age</th>
      <td id="T_9c77c_row0_col0" class="data row0 col0" >0.972778</td>
      <td id="T_9c77c_row0_col1" class="data row0 col1" >1.415074</td>
      <td id="T_9c77c_row0_col2" class="data row0 col2" >1.415074</td>
      <td id="T_9c77c_row0_col3" class="data row0 col3" >-1.902148</td>
      <td id="T_9c77c_row0_col4" class="data row0 col4" >-1.459852</td>
    </tr>
    <tr>
      <th id="T_9c77c_level0_row1" class="row_heading level0 row1" >sex</th>
      <td id="T_9c77c_row1_col0" class="data row1 col0" >0.649445</td>
      <td id="T_9c77c_row1_col1" class="data row1 col1" >0.649445</td>
      <td id="T_9c77c_row1_col2" class="data row1 col2" >0.649445</td>
      <td id="T_9c77c_row1_col3" class="data row1 col3" >0.649445</td>
      <td id="T_9c77c_row1_col4" class="data row1 col4" >-1.533413</td>
    </tr>
    <tr>
      <th id="T_9c77c_level0_row2" class="row_heading level0 row2" >cp</th>
      <td id="T_9c77c_row2_col0" class="data row2 col0" >-2.020077</td>
      <td id="T_9c77c_row2_col1" class="data row2 col1" >0.884034</td>
      <td id="T_9c77c_row2_col2" class="data row2 col2" >0.884034</td>
      <td id="T_9c77c_row2_col3" class="data row2 col3" >-0.084003</td>
      <td id="T_9c77c_row2_col4" class="data row2 col4" >-1.052040</td>
    </tr>
    <tr>
      <th id="T_9c77c_level0_row3" class="row_heading level0 row3" >trestbps</th>
      <td id="T_9c77c_row3_col0" class="data row3 col0" >0.721008</td>
      <td id="T_9c77c_row3_col1" class="data row3 col1" >1.543527</td>
      <td id="T_9c77c_row3_col2" class="data row3 col2" >-0.649858</td>
      <td id="T_9c77c_row3_col3" class="data row3 col3" >-0.101512</td>
      <td id="T_9c77c_row3_col4" class="data row3 col4" >-0.101512</td>
    </tr>
    <tr>
      <th id="T_9c77c_level0_row4" class="row_heading level0 row4" >chol</th>
      <td id="T_9c77c_row4_col0" class="data row4 col0" >-0.251855</td>
      <td id="T_9c77c_row4_col1" class="data row4 col1" >0.740555</td>
      <td id="T_9c77c_row4_col2" class="data row4 col2" >-0.326754</td>
      <td id="T_9c77c_row4_col3" class="data row4 col3" >0.066465</td>
      <td id="T_9c77c_row4_col4" class="data row4 col4" >-0.794872</td>
    </tr>
    <tr>
      <th id="T_9c77c_level0_row5" class="row_heading level0 row5" >fbs</th>
      <td id="T_9c77c_row5_col0" class="data row5 col0" >2.426901</td>
      <td id="T_9c77c_row5_col1" class="data row5 col1" >-0.410346</td>
      <td id="T_9c77c_row5_col2" class="data row5 col2" >-0.410346</td>
      <td id="T_9c77c_row5_col3" class="data row5 col3" >-0.410346</td>
      <td id="T_9c77c_row5_col4" class="data row5 col4" >-0.410346</td>
    </tr>
    <tr>
      <th id="T_9c77c_level0_row6" class="row_heading level0 row6" >restecg</th>
      <td id="T_9c77c_row6_col0" class="data row6 col0" >1.070838</td>
      <td id="T_9c77c_row6_col1" class="data row6 col1" >1.070838</td>
      <td id="T_9c77c_row6_col2" class="data row6 col2" >1.070838</td>
      <td id="T_9c77c_row6_col3" class="data row6 col3" >-0.953715</td>
      <td id="T_9c77c_row6_col4" class="data row6 col4" >1.070838</td>
    </tr>
    <tr>
      <th id="T_9c77c_level0_row7" class="row_heading level0 row7" >thalach</th>
      <td id="T_9c77c_row7_col0" class="data row7 col0" >-0.025055</td>
      <td id="T_9c77c_row7_col1" class="data row7 col1" >-1.831151</td>
      <td id="T_9c77c_row7_col2" class="data row7 col2" >-0.928103</td>
      <td id="T_9c77c_row7_col3" class="data row7 col3" >1.566030</td>
      <td id="T_9c77c_row7_col4" class="data row7 col4" >0.920995</td>
    </tr>
    <tr>
      <th id="T_9c77c_level0_row8" class="row_heading level0 row8" >exang</th>
      <td id="T_9c77c_row8_col0" class="data row8 col0" >-0.721010</td>
      <td id="T_9c77c_row8_col1" class="data row8 col1" >1.381212</td>
      <td id="T_9c77c_row8_col2" class="data row8 col2" >1.381212</td>
      <td id="T_9c77c_row8_col3" class="data row8 col3" >-0.721010</td>
      <td id="T_9c77c_row8_col4" class="data row8 col4" >-0.721010</td>
    </tr>
    <tr>
      <th id="T_9c77c_level0_row9" class="row_heading level0 row9" >oldpeak</th>
      <td id="T_9c77c_row9_col0" class="data row9 col0" >0.986440</td>
      <td id="T_9c77c_row9_col1" class="data row9 col1" >0.330395</td>
      <td id="T_9c77c_row9_col2" class="data row9 col2" >1.232457</td>
      <td id="T_9c77c_row9_col3" class="data row9 col3" >1.970508</td>
      <td id="T_9c77c_row9_col4" class="data row9 col4" >0.248389</td>
    </tr>
    <tr>
      <th id="T_9c77c_level0_row10" class="row_heading level0 row10" >slope</th>
      <td id="T_9c77c_row10_col0" class="data row10 col0" >2.334348</td>
      <td id="T_9c77c_row10_col1" class="data row10 col1" >0.687374</td>
      <td id="T_9c77c_row10_col2" class="data row10 col2" >0.687374</td>
      <td id="T_9c77c_row10_col3" class="data row10 col3" >2.334348</td>
      <td id="T_9c77c_row10_col4" class="data row10 col4" >-0.959601</td>
    </tr>
    <tr>
      <th id="T_9c77c_level0_row11" class="row_heading level0 row11" >ca</th>
      <td id="T_9c77c_row11_col0" class="data row11 col0" >-0.770198</td>
      <td id="T_9c77c_row11_col1" class="data row11 col1" >2.425024</td>
      <td id="T_9c77c_row11_col2" class="data row11 col2" >1.359950</td>
      <td id="T_9c77c_row11_col3" class="data row11 col3" >-0.770198</td>
      <td id="T_9c77c_row11_col4" class="data row11 col4" >-0.770198</td>
    </tr>
    <tr>
      <th id="T_9c77c_level0_row12" class="row_heading level0 row12" >thal</th>
      <td id="T_9c77c_row12_col0" class="data row12 col0" >-2.070238</td>
      <td id="T_9c77c_row12_col1" class="data row12 col1" >-0.514345</td>
      <td id="T_9c77c_row12_col2" class="data row12 col2" >1.041548</td>
      <td id="T_9c77c_row12_col3" class="data row12 col3" >-0.514345</td>
      <td id="T_9c77c_row12_col4" class="data row12 col4" >-0.514345</td>
    </tr>
    <tr>
      <th id="T_9c77c_level0_row13" class="row_heading level0 row13" >ground_truth</th>
      <td id="T_9c77c_row13_col0" class="data row13 col0" >0.000000</td>
      <td id="T_9c77c_row13_col1" class="data row13 col1" >1.000000</td>
      <td id="T_9c77c_row13_col2" class="data row13 col2" >0.000000</td>
      <td id="T_9c77c_row13_col3" class="data row13 col3" >0.000000</td>
      <td id="T_9c77c_row13_col4" class="data row13 col4" >0.000000</td>
    </tr>
  </tbody>
</table>

## Hyperparameter search

The choice of the batch size and the maximum number of epochs depends on
the dataset size. For this dataset, we use the following values:

``` python
batch_size = 16
max_epochs = 50
```

We use the Type-2 architecture built using
[`MonoDense`](api/airt/keras/layers/MonoDense/#airt.keras.layers.MonoDense)
layer with the following set of hyperparameters ranges:

``` python
def hp_params_f(hp):
    return dict(
        units=hp.Int("units", min_value=16, max_value=32, step=1),
        n_layers=hp.Int("n_layers", min_value=2, max_value=2),
        activation=hp.Choice("activation", values=["elu"]),
        learning_rate=hp.Float(
            "learning_rate", min_value=1e-4, max_value=1e-2, sampling="log"
        ),
        weight_decay=hp.Float(
            "weight_decay", min_value=3e-2, max_value=0.3, sampling="log"
        ),
        dropout=hp.Float("dropout", min_value=0.0, max_value=0.5, sampling="linear"),
        decay_rate=hp.Float(
            "decay_rate", min_value=0.8, max_value=1.0, sampling="reverse_log"
        ),
    )
```

The following fixed parameters are used to build the Type-2 architecture
for this dataset:

- `final_activation` is used to build the final layer for regression
  problem (set to `None`) or for the classification problem
  (`"sigmoid"`),

- `loss` is used for training regression (`"mse"`) or classification
  (`"binary_crossentropy"`) problem, and

- `metrics` denotes metrics used to compare with previosly published
  results: `"accuracy"` for classification and “`mse`” or “`rmse`” for
  regression.

Parameters `objective` and `direction` are used by the tuner such that
`objective=f"val_{metrics}"` and direction is either `"min` or `"max"`.

Parameters `max_trials` denotes the number of trial performed buy the
tuner, `patience` is the number of epochs allowed to perform worst than
the best one before stopping the current trial. The parameter
`execution_per_trial` denotes the number of runs before calculating the
results of a trial, it should be set to value greater than 1 for small
datasets that have high variance in results.

``` python
final_activation = "sigmoid"
loss = "binary_crossentropy"
metrics = "accuracy"
objective = "val_accuracy"
direction = "max"
max_trials = 200
executions_per_trial = 3
patience = 5
```

The following table describes the best models and their hyperparameters
found by the tuner:

<style type="text/css">
</style>
<table id="T_da0d8">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_da0d8_level0_col0" class="col_heading level0 col0" >0</th>
      <th id="T_da0d8_level0_col1" class="col_heading level0 col1" >1</th>
      <th id="T_da0d8_level0_col2" class="col_heading level0 col2" >2</th>
      <th id="T_da0d8_level0_col3" class="col_heading level0 col3" >3</th>
      <th id="T_da0d8_level0_col4" class="col_heading level0 col4" >4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_da0d8_level0_row0" class="row_heading level0 row0" >units</th>
      <td id="T_da0d8_row0_col0" class="data row0 col0" >22</td>
      <td id="T_da0d8_row0_col1" class="data row0 col1" >18</td>
      <td id="T_da0d8_row0_col2" class="data row0 col2" >23</td>
      <td id="T_da0d8_row0_col3" class="data row0 col3" >23</td>
      <td id="T_da0d8_row0_col4" class="data row0 col4" >21</td>
    </tr>
    <tr>
      <th id="T_da0d8_level0_row1" class="row_heading level0 row1" >n_layers</th>
      <td id="T_da0d8_row1_col0" class="data row1 col0" >2</td>
      <td id="T_da0d8_row1_col1" class="data row1 col1" >2</td>
      <td id="T_da0d8_row1_col2" class="data row1 col2" >2</td>
      <td id="T_da0d8_row1_col3" class="data row1 col3" >2</td>
      <td id="T_da0d8_row1_col4" class="data row1 col4" >2</td>
    </tr>
    <tr>
      <th id="T_da0d8_level0_row2" class="row_heading level0 row2" >activation</th>
      <td id="T_da0d8_row2_col0" class="data row2 col0" >elu</td>
      <td id="T_da0d8_row2_col1" class="data row2 col1" >elu</td>
      <td id="T_da0d8_row2_col2" class="data row2 col2" >elu</td>
      <td id="T_da0d8_row2_col3" class="data row2 col3" >elu</td>
      <td id="T_da0d8_row2_col4" class="data row2 col4" >elu</td>
    </tr>
    <tr>
      <th id="T_da0d8_level0_row3" class="row_heading level0 row3" >learning_rate</th>
      <td id="T_da0d8_row3_col0" class="data row3 col0" >0.001000</td>
      <td id="T_da0d8_row3_col1" class="data row3 col1" >0.001000</td>
      <td id="T_da0d8_row3_col2" class="data row3 col2" >0.001328</td>
      <td id="T_da0d8_row3_col3" class="data row3 col3" >0.001000</td>
      <td id="T_da0d8_row3_col4" class="data row3 col4" >0.001000</td>
    </tr>
    <tr>
      <th id="T_da0d8_level0_row4" class="row_heading level0 row4" >weight_decay</th>
      <td id="T_da0d8_row4_col0" class="data row4 col0" >0.113929</td>
      <td id="T_da0d8_row4_col1" class="data row4 col1" >0.122019</td>
      <td id="T_da0d8_row4_col2" class="data row4 col2" >0.111481</td>
      <td id="T_da0d8_row4_col3" class="data row4 col3" >0.139452</td>
      <td id="T_da0d8_row4_col4" class="data row4 col4" >0.140732</td>
    </tr>
    <tr>
      <th id="T_da0d8_level0_row5" class="row_heading level0 row5" >dropout</th>
      <td id="T_da0d8_row5_col0" class="data row5 col0" >0.397874</td>
      <td id="T_da0d8_row5_col1" class="data row5 col1" >0.460844</td>
      <td id="T_da0d8_row5_col2" class="data row5 col2" >0.405396</td>
      <td id="T_da0d8_row5_col3" class="data row5 col3" >0.424631</td>
      <td id="T_da0d8_row5_col4" class="data row5 col4" >0.418484</td>
    </tr>
    <tr>
      <th id="T_da0d8_level0_row6" class="row_heading level0 row6" >decay_rate</th>
      <td id="T_da0d8_row6_col0" class="data row6 col0" >0.894921</td>
      <td id="T_da0d8_row6_col1" class="data row6 col1" >0.921600</td>
      <td id="T_da0d8_row6_col2" class="data row6 col2" >0.901050</td>
      <td id="T_da0d8_row6_col3" class="data row6 col3" >0.897339</td>
      <td id="T_da0d8_row6_col4" class="data row6 col4" >0.889619</td>
    </tr>
    <tr>
      <th id="T_da0d8_level0_row7" class="row_heading level0 row7" >val_accuracy_mean</th>
      <td id="T_da0d8_row7_col0" class="data row7 col0" >0.885246</td>
      <td id="T_da0d8_row7_col1" class="data row7 col1" >0.885246</td>
      <td id="T_da0d8_row7_col2" class="data row7 col2" >0.881967</td>
      <td id="T_da0d8_row7_col3" class="data row7 col3" >0.881967</td>
      <td id="T_da0d8_row7_col4" class="data row7 col4" >0.878689</td>
    </tr>
    <tr>
      <th id="T_da0d8_level0_row8" class="row_heading level0 row8" >val_accuracy_std</th>
      <td id="T_da0d8_row8_col0" class="data row8 col0" >0.000000</td>
      <td id="T_da0d8_row8_col1" class="data row8 col1" >0.000000</td>
      <td id="T_da0d8_row8_col2" class="data row8 col2" >0.007331</td>
      <td id="T_da0d8_row8_col3" class="data row8 col3" >0.007331</td>
      <td id="T_da0d8_row8_col4" class="data row8 col4" >0.008979</td>
    </tr>
    <tr>
      <th id="T_da0d8_level0_row9" class="row_heading level0 row9" >val_accuracy_min</th>
      <td id="T_da0d8_row9_col0" class="data row9 col0" >0.885246</td>
      <td id="T_da0d8_row9_col1" class="data row9 col1" >0.885246</td>
      <td id="T_da0d8_row9_col2" class="data row9 col2" >0.868852</td>
      <td id="T_da0d8_row9_col3" class="data row9 col3" >0.868852</td>
      <td id="T_da0d8_row9_col4" class="data row9 col4" >0.868852</td>
    </tr>
    <tr>
      <th id="T_da0d8_level0_row10" class="row_heading level0 row10" >val_accuracy_max</th>
      <td id="T_da0d8_row10_col0" class="data row10 col0" >0.885246</td>
      <td id="T_da0d8_row10_col1" class="data row10 col1" >0.885246</td>
      <td id="T_da0d8_row10_col2" class="data row10 col2" >0.885246</td>
      <td id="T_da0d8_row10_col3" class="data row10 col3" >0.885246</td>
      <td id="T_da0d8_row10_col4" class="data row10 col4" >0.885246</td>
    </tr>
    <tr>
      <th id="T_da0d8_level0_row11" class="row_heading level0 row11" >params</th>
      <td id="T_da0d8_row11_col0" class="data row11 col0" >1605</td>
      <td id="T_da0d8_row11_col1" class="data row11 col1" >1077</td>
      <td id="T_da0d8_row11_col2" class="data row11 col2" >1672</td>
      <td id="T_da0d8_row11_col3" class="data row11 col3" >1672</td>
      <td id="T_da0d8_row11_col4" class="data row11 col4" >1538</td>
    </tr>
  </tbody>
</table>

## The optimal model

These are the best hyperparameters found by previous runs of the tuner:

``` python
def final_hp_params_f(hp):
    return dict(
        units=hp.Fixed("units", value=22),
        n_layers=hp.Fixed("n_layers", 2),
        activation=hp.Fixed("activation", value="elu"),
        learning_rate=hp.Fixed("learning_rate", value=0.001),
        weight_decay=hp.Fixed("weight_decay", value=0.113929),
        dropout=hp.Fixed("dropout", value=0.397874),
        decay_rate=hp.Fixed("decay_rate", value=0.894921),
    )
```

The final evaluation of the optimal model:

<style type="text/css">
</style>
<table id="T_450fc">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_450fc_level0_col0" class="col_heading level0 col0" >0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_450fc_level0_row0" class="row_heading level0 row0" >units</th>
      <td id="T_450fc_row0_col0" class="data row0 col0" >22</td>
    </tr>
    <tr>
      <th id="T_450fc_level0_row1" class="row_heading level0 row1" >n_layers</th>
      <td id="T_450fc_row1_col0" class="data row1 col0" >2</td>
    </tr>
    <tr>
      <th id="T_450fc_level0_row2" class="row_heading level0 row2" >activation</th>
      <td id="T_450fc_row2_col0" class="data row2 col0" >elu</td>
    </tr>
    <tr>
      <th id="T_450fc_level0_row3" class="row_heading level0 row3" >learning_rate</th>
      <td id="T_450fc_row3_col0" class="data row3 col0" >0.001000</td>
    </tr>
    <tr>
      <th id="T_450fc_level0_row4" class="row_heading level0 row4" >weight_decay</th>
      <td id="T_450fc_row4_col0" class="data row4 col0" >0.113929</td>
    </tr>
    <tr>
      <th id="T_450fc_level0_row5" class="row_heading level0 row5" >dropout</th>
      <td id="T_450fc_row5_col0" class="data row5 col0" >0.397874</td>
    </tr>
    <tr>
      <th id="T_450fc_level0_row6" class="row_heading level0 row6" >decay_rate</th>
      <td id="T_450fc_row6_col0" class="data row6 col0" >0.894921</td>
    </tr>
    <tr>
      <th id="T_450fc_level0_row7" class="row_heading level0 row7" >val_accuracy_mean</th>
      <td id="T_450fc_row7_col0" class="data row7 col0" >0.885246</td>
    </tr>
    <tr>
      <th id="T_450fc_level0_row8" class="row_heading level0 row8" >val_accuracy_std</th>
      <td id="T_450fc_row8_col0" class="data row8 col0" >0.000000</td>
    </tr>
    <tr>
      <th id="T_450fc_level0_row9" class="row_heading level0 row9" >val_accuracy_min</th>
      <td id="T_450fc_row9_col0" class="data row9 col0" >0.885246</td>
    </tr>
    <tr>
      <th id="T_450fc_level0_row10" class="row_heading level0 row10" >val_accuracy_max</th>
      <td id="T_450fc_row10_col0" class="data row10 col0" >0.885246</td>
    </tr>
    <tr>
      <th id="T_450fc_level0_row11" class="row_heading level0 row11" >params</th>
      <td id="T_450fc_row11_col0" class="data row11 col0" >1605</td>
    </tr>
  </tbody>
</table>
